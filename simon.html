<!doctype html>

<html lang="en">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="description" content="Simon game. Test your memory!">
<meta name="author" content="Kevin Nolan">

<link href="https://fonts.googleapis.com/css?family=Catamaran" rel="stylesheet">

<title>Simon</title>

<style>
.sb { /* Class for all Simon buttons*/
  height: 100px;
  width: 200px;
}
.red-btn {
  background-color: #900
}
.blue-btn {
  background-color: #009;
}
.yellow-btn {
  background-color: #990
}
.green-btn {
  background-color: #090;
}
.red-btn-lit {
  background-color: #f55;
}
.blue-btn-lit {
  background-color: #55f;
}
.yellow-btn-lit {
  background-color: #ff9;
}
.green-btn-lit {
  background-color: #9f9;
}


</style>
</head>

<body>
<h1>Simon</h1>
<p> Level: <span id="disp-level">1</span></p>
<button id="red-btn" class="sb red-btn" onclick="pressSB(0)"></button><br>
<button id="blue-btn" class="sb blue-btn" onclick="pressSB(1)"></button><br>
<button id="yellow-btn" class="sb yellow-btn" onclick="pressSB(2)"></button><br>
<button id="green-btn" class="sb green-btn" onclick="pressSB(3)"></button>

<script>

// Presented with a random sequence of button presses
// Each time I enter the sequence correctly I see the same series with an extra step
// Each step has audio and lights up
// If I press the wrong button I'm told I have done so and the sequence repeats so I can retry.
// I can see how many steps I've gone so far
// I can restart to go back to a single step
// A strict mode option where getting a step wrong returns me to the restart
// If I get 20 steps right I win the game, am notified of my victory and the game restarts
// Bonus: user-settable win steps icluding endless
let sequence = []; // r=0, b=1, y=2, g=3
let rightSoFar = 0; // How many steps the player gets right this turn
//let playerTurn=false; // When player can act

const btn = [
  {elem: document.getElementById("red-btn"), dClass: "sb red-btn", lClass: "sb red-btn-lit"},
  {elem: document.getElementById("blue-btn"), dClass: "sb blue-btn", lClass: "sb blue-btn-lit"},
  {elem: document.getElementById("yellow-btn"), dClass: "sb yellow-btn", lClass: "sb yellow-btn-lit"},
  {elem: document.getElementById("green-btn"), dClass: "sb green-btn", lClass: "sb green-btn-lit"}];

addStep();

replay();

function pressSB(btnPressed) {
  if (btnPressed == sequence[rightSoFar]) {
    console.log ("Yup! " + btnPressed + ":" + sequence[rightSoFar]);
    rightSoFar += 1;
  } else {
    console.log ("Nope! " + btnPressed + ":" + sequence[rightSoFar]);
  }
  if (rightSoFar >= sequence.length) addStep();
}

function addStep() {
  playerTurn(false);
  showLev = document.getElementById("disp-level");
  sequence.push(Math.floor(Math.random()*4));
  console.log("All correct! Next level.");
  setTimeout(function() {
    showLev.innerHTML = sequence.length
    replay();
    }, 500);
}

function replay() {
  let step = 0;
  const play = setInterval(playStep,500);

  function playStep() {
    let thisBtn = btn[sequence[step]]; // Choose colour according to position in sequence
    thisBtn.elem.className=thisBtn.lClass; // Change to lit class
    setTimeout(function() {
      thisBtn.elem.className=thisBtn.dClass // Change back to dark class
    },400);
    step +=1;
    if (step >= sequence.length) {
      clearInterval(play);
      setTimeout(() => playerTurn(true),500);
    }
  }
}


function playerTurn(isIt) {
  if (isIt) {
    btn.forEach(val => val.elem.disabled = false);
  } else {
    btn.forEach(val => val.elem.disabled = true);
  }
}

</script>

</body>